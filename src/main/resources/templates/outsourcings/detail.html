<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>외주 상세보기</title>
    <!-- <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico"> -->

    <!-- css -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/content.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/component.css">
    <!-- //css -->

    <!-- script -->
    <script src="/js/jquery-1.11.3.min.js"></script>
    <script src="/js/jquery.easing.1.3.js"></script>
    <!-- //script -->
</head>
<body>

<!-- Header -->
<header>
    <h1>외주 상세 정보</h1>
</header>

<!-- Main Content -->
<main>
    <div class="con_body">
        <section th:data-id="${outsourcing.id}">
        <h2 th:text="${outsourcing.title}">외주 제목</h2>
            <p><strong>작성자:</strong> <span th:text="${outsourcing.nickname}">작성자</span></p>
            <p><strong>설명:</strong> <span th:text="${outsourcing.content}">외주 설명</span></p>
            <p><strong>지역:</strong> <span th:text="${outsourcing.area}">지역 정보</span></p>
            <p><strong>예산:</strong> <span th:text="${outsourcing.price}">예산 금액</span>원</p>
            <!-- 파일 이미지 리스트 -->
            <div>
                <h4>첨부 이미지:</h4>
                <ul>
                    <!-- filePaths 리스트를 반복하여 각 파일 경로를 표시 -->
                    <li th:each="filePath : ${outsourcing.filePaths}">
                        <img th:src="@{${filePath}}" alt="첨부 이미지" style="max-width: 200px; max-height: 150px;">
                    </li>
                </ul>
            </div>
        </section>

        <!-- 수정하기 및 삭제하기 버튼 -->
        <div style="margin-top: 20px;">
            <!-- 수정하기 버튼: GET 요청으로 update 페이지 이동 -->
            <a th:href="@{/outsourcings/edit/{id}(id=${outsourcing.id})}">
                <button type="button">수정하기</button>
            </a>

            <!-- 삭제하기 버튼 -->
            <button type="button" onclick="deleteOutsourcing()">삭제하기</button>
        </div>
    </div>
</main>

<!-- Footer -->
<footer>
    <p>&copy; 2024 외주 플랫폼</p>
</footer>

<script>
    const token = "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJ0ZXN0QG5hdmVyLmNvbSIsIm5pY2tuYW1lIjoi65S46riwIiwidXNlclR5cGUiOiJDT01QQU5ZIiwidXNlclJvbGUiOiJST0xFX1VTRVIiLCJleHAiOjE3MzA5NTgyODQsImlhdCI6MTczMDk1NDY4NH0.M0f8Vtk9GAhyYhpBZwove29zkJX8FzXEZiZnmE_COjU";
    // 삭제 기능 호출
    function deleteOutsourcing() {
        const confirmation = confirm("정말 삭제하시겠습니까?");

        if (confirmation) {
            // data-id 속성에서 outsourcing.id 값을 가져옴
            const outsourcingId = document.querySelector("section").getAttribute("data-id");
            console.log(outsourcingId)

            fetch(`http://localhost:8080/outsourcings/${outsourcingId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': token
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("삭제되었습니다.");
                        window.location.href = "/outsourcings/list"; // 목록 페이지로 리다이렉트
                    } else {
                        alert("삭제에 실패했습니다.");
                    }
                })
                .catch(error => {
                    console.error("삭제 중 에러 발생:", error);
                    alert("서버 오류로 삭제에 실패했습니다.");
                });
        }
    }
</script>

</body>
</html>
